<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="T00">
    
    <title>
        
            MySQL--锁的概述 |
        
        Keeping T00
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/solid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/brands.min.css">
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Keeping T00","author":"T00","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/","archives":"/archives","tags":"/tags","categories":"/categories","links":"/links"},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":true,"percent":true,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"cdnjs"},"pjax":{"enable":true},"footer":{"since":2025,"word_count":true,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Keeping T00
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                TAGS
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                CATEGORIES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/links">
                                
                                LINKS
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                            TAGS
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                            CATEGORIES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/links">
                            
                            LINKS
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        MySQL--锁的概述
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">T00</span>
                                
                                    <span class="author-badge">Lv2</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-08-05 18:18:59</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Tue Aug 05 2025 20:16:38 GMT+0800">2025-08-05 20:16:38</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/MySQL/">MySQL</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/MySQL/">MySQL</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>3.4k Words</span>
            </span>
        
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <blockquote>
<p>锁是计算机协调<strong>多个进程或线程</strong>并发访问某一资源的机制。在数据库中，除传统的计算资源（CPU、 RAM、I&#x2F;O）的争用以外，<strong>数据</strong>也是一种供许多用户共享的资源。如何保证数据并发访问的<strong>一致性、有效性</strong>是所有数据库必须解决的一个问题，<strong>锁冲突</strong>也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
</blockquote>
<p>MySQL中的锁，按照锁的粒度分，分为以下三类： </p>
<ul>
<li>全局锁：锁定数据库中的<strong>所有表</strong>。 </li>
<li>表级锁：每次操作锁住<strong>整张表</strong>。 </li>
<li>行级锁：每次操作锁住<strong>对应的行数据</strong>。</li>
</ul>
<h1 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h1><blockquote>
<p><strong>全局锁</strong>就是对<strong>整个数据库实例</strong>加锁，加锁后整个实例就处于<strong>只读状态</strong>，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被<strong>阻塞</strong>。</p>
</blockquote>
<p>全局锁的应用一般就是数据备份时使用，那为什么全库逻辑备份，就需要加全局锁呢？</p>
<p>我们来从是否加全局锁对于备份的影响来分析一下：</p>
<ol>
<li>不加全局锁</li>
</ol>
<p>假设在数据库中存在这样三张表: tb_stock 库存表，tb_order 订单表，tb_orderlog 订单日志表。</p>
<p>备份操作如下图：</p>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805150108374.2obu8o8av1.webp"
                         alt="image-20250805150108374" 
                 >

<ul>
<li>在进行数据备份时，先备份了tb_stock库存表。 </li>
<li>然后接下来，在业务系统中，执行了下单操作，<strong>扣减库存，生成订单</strong>（更新tb_stock表，插入 tb_order表）。 </li>
<li>然后再执行备份 tb_order表的逻辑。 </li>
<li>业务中执行插入订单日志操作。 </li>
<li>最后，又备份了tb_orderlog表。</li>
</ul>
<p>此时备份出来的数据，是存在问题的。因为备份出来的数据，tb_stock表与tb_order表的**数据不一 致(**有最新操作的订单信息,但是库存数没减)。</p>
<p>那如何来规避这种问题呢? </p>
<p>此时就可以借助于MySQL的<strong>全局锁</strong>来解决。</p>
<ol start="2">
<li>加了全局锁后的情况</li>
</ol>
<p>如下图：红色操作是被阻塞的，绿色是放行的（<strong>下面所有图都是这个描述，后面将不再赘述</strong>）。</p>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805150155514.5trc7m2pry.webp"
                         alt="image-20250805150155514" 
                 >

<p>对数据库进行<strong>进行逻辑备份之前</strong>，先对整个数据库加上<strong>全局锁</strong>，一旦加了全局锁之后，其他的DDL、 DML全部都处于<strong>阻塞</strong>状态，但是可以执行DQL语句，也就是处于<strong>只读状态</strong>，而数据<strong>备份就是查询操作</strong>。 那么数据在进行逻辑备份的过程中，数据库中的数据就是不会发生变化的，这样就保证了数据的<strong>一致性和完整性</strong>。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><ol>
<li>加全局锁</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock ;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>数据备份</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump  -uroot –p101 itcast &gt; itcast.sql;</span><br></pre></td></tr></table></figure>

<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805151747692.7zqqtdudj3.webp"
                         alt="image-20250805151747692" 
                 >

<ol start="3">
<li>释放锁</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables ;</span><br></pre></td></tr></table></figure>

<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805151741407.51egpvm41r.webp"
                         alt="image-20250805151741407" 
                 >

<p>最终备份如下：</p>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805151755992.2obu8o8av4.webp"
                         alt="image-20250805151755992" 
                 >

<p>但其实数据库中加全局锁，是一个<strong>比较重</strong>的操作，存在以下问题： </p>
<ol>
<li>如果在主库上备份，那么在备份期间都不能执行更新，<strong>业务基本上就得停摆。</strong> </li>
<li>如果在从库上备份，那么在备份期间从库不能执行主库同步过来的二进制日志（binlog），会导致<strong>主从延迟</strong>。</li>
</ol>
<p>在InnoDB引擎中，我们可以在备份时加上参数<code>--single-transaction</code>参数来完成<strong>不加锁的一致性</strong>数据备份。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --single-transaction -uroot –p101 itcast &gt; itcast.sql</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h1><blockquote>
<p>表级锁，每次操作锁住<strong>整张表</strong>。锁定粒度大，发生<strong>锁冲突的概率最高</strong>，<strong>并发度最低</strong>。应用在MyISAM、 InnoDB、BDB等存储引擎中。 </p>
</blockquote>
<p>对于表级锁，主要分为以下三类： </p>
<ul>
<li>表锁 </li>
<li>元数据锁（meta data lock，MDL） </li>
<li>意向锁</li>
</ul>
<p>接下来对这三种锁进行解析。</p>
<h2 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h2><blockquote>
<p>对于表锁，分为两类： </p>
<ul>
<li>表<strong>共享读</strong>锁（read lock） </li>
<li>表<strong>独占写</strong>锁（write lock）</li>
</ul>
</blockquote>
<ol>
<li>加锁</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock tables 表名... read<span class="operator">/</span>write</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>释放锁</p>
<ol>
<li><p>客户端断开连接时会自动释放锁</p>
</li>
<li><p>也可以通过以下指令手动释放锁</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="读锁"><a href="#读锁" class="headerlink" title="读锁"></a>读锁</h3><blockquote>
<p>左侧为客户端一，对指定表加了<strong>读锁</strong>，不会影响右侧客户端二的读，但是会<strong>阻塞右侧客户端的写</strong>。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805152233629.2obu8o8av5.webp"
                         alt="image-20250805152233629" 
                 >

<h3 id="写锁"><a href="#写锁" class="headerlink" title="写锁"></a>写锁</h3><blockquote>
<p>左侧为客户端一，对指定表加了写锁，会<strong>阻塞右侧客户端的读和写</strong>。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805152250724.45hzafcflu.webp"
                         alt="image-20250805152250724" 
                 >

<hr>
<h2 id="元数据锁"><a href="#元数据锁" class="headerlink" title="元数据锁"></a>元数据锁</h2><blockquote>
<p>meta data lock , 元数据锁，简写MDL。</p>
<p>MDL加锁过程是<strong>系统自动</strong>控制，无需显式使用，在访问一张表的时候会自动加上。</p>
</blockquote>
<p>MDL锁主要作用是维护<strong>表元数据的数据一致性</strong>，在表上有活动事务的时候，不可以对元数据进行写入操作。为了避免DML与DDL冲突，保证读写的正确性。</p>
<blockquote>
<p>（元数据就可以简单理解为这个表结构，也就是说，某一张表涉及到未提交的事务时，是不能够修改这张表的表结构的。）</p>
</blockquote>
<table>
<thead>
<tr>
<th>对应SQL</th>
<th>锁类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>lock tables xxx read &#x2F; write</td>
<td>SHARED_READ_ONLY &#x2F; SHARED_NO_READ_WRITE</td>
<td></td>
</tr>
<tr>
<td>select 、select … lock in share mode</td>
<td>SHARED_READ</td>
<td>与SHARED_READ、  SHARED_WRITE兼容，与 EXCLUSIVE互斥</td>
</tr>
<tr>
<td>insert 、update、 delete、select … for update</td>
<td>SHARED_WRITE</td>
<td>与SHARED_READ、 SHARED_WRITE兼容，与 EXCLUSIVE互斥</td>
</tr>
<tr>
<td>alter table …</td>
<td>EXCLUSIVE</td>
<td>与其他的MDL都互斥</td>
</tr>
</tbody></table>
<p>我们可以通过如下命令，查看当前的锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_type,object_schema,object_name,lock_type,lock_duration <span class="keyword">from</span> performance_schema.metadata_locks ;</span><br></pre></td></tr></table></figure>

<p>下面我们通过示例的方式来解释它的两个特点：</p>
<ul>
<li>创建两个客户端。</li>
</ul>
<ol>
<li>当执行SELECT、INSERT、UPDATE、DELETE等语句时，添加的是元数据共享锁（SHARED_READ &#x2F;  SHARED_WRITE），之间是兼容的。</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805153947874.9rjpoadqf8.webp"
                         alt="image-20250805153947874" 
                 >

<ol start="2">
<li>当执行SELECT语句时，添加的是元数据共享锁（SHARED_READ），会阻塞元数据排他锁 （EXCLUSIVE），之间是互斥的。</li>
</ol>
<blockquote>
<p>可以看见左侧客户端上传之后，右侧才能修改成功，在这之前是一直处于堵塞状态。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805154325035.13m397b3es.webp"
                         alt="image-20250805154325035" 
                 >

<hr>
<h2 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h2><blockquote>
<p>为了避免DML在执行时，加的<strong>行锁与表锁</strong>的冲突，在InnoDB中引入了意向锁，使得表锁<strong>不用检查每行数据是否加锁</strong>，使用意向锁来减少表锁的检查。</p>
</blockquote>
<p>意向锁又分为：</p>
<ol>
<li>意向共享锁(IS): 由语句select … lock in share mode添加 。 与表锁共享锁 (read)兼容，与表锁排他锁(write)互斥。 </li>
<li>意向排他锁(IX): 由insert、update、delete、select…for update添加 。与表锁共享锁(read)及排他锁(write)都互斥，意向锁之间不会互斥。</li>
</ol>
<p>一旦事务提交了，意向共享锁、意向排他锁，都会自动释放。</p>
<p>我们来看看意向锁是怎么解决<strong>行锁与表锁之间的冲突</strong>的：</p>
<ol>
<li>没有意向锁时</li>
</ol>
<blockquote>
<p>客户端一对表加了行锁后，客户端二如何给表加表锁呢：首先客户端一，开启一个事务，然后执行DML操作，在执行DML语句时，会对涉及到的行加行锁。</p>
<p>当客户端二，想对这张表<strong>加表锁</strong>时，会<strong>检查当前表是否有对应的行锁</strong>，如果没有，则添加表锁，此时就会从第一行数据，检查到最后一行数据，<strong>效率较低</strong>。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805154752389.4n80z0dt6w.webp"
                         alt="image-20250805154752389" 
                 >

<ol start="2">
<li>有意向锁后</li>
</ol>
<blockquote>
<p>客户端一，在执行DML操作时，会对<strong>涉及的行加行锁</strong>，<strong>同时也会对该表加上意向锁</strong>。</p>
<p>而其他客户端，在对这张表加表锁的时候，会根据该表上所加的意向锁来判定<strong>是否可以成功加表锁</strong>，而不用逐行判断行锁情况了（和<strong>提前打上一个标记</strong>同样的意思）。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805154820893.7zqqtdudjd.webp"
                         alt="image-20250805154820893" 
                 >

<p>下面我们来演示一下各种兼容或排斥的情况：</p>
<ol>
<li>意向共享锁与表读锁是兼容的，但是与表写锁是互斥的</li>
</ol>
<blockquote>
<p>左侧在加上意向共享锁之后，右侧可以直接添加表读锁，但是必须等左侧提交事务过后才能添加表写锁。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805160004032.8s3mb4az9l.webp"
                         alt="image-20250805160004032" 
                 >

<ol start="2">
<li>意向排他锁与表读锁、写锁都是互斥的</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805160315407.58holb89hm.webp"
                         alt="image-20250805160315407" 
                 >

<hr>
<h1 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h1><blockquote>
<p>行级锁，每次操作锁住<strong>对应的行数据</strong>。锁定粒度最小，发生<strong>锁冲突的概率最低</strong>，并发度最高。应用在 InnoDB存储引擎中。</p>
</blockquote>
<p>InnoDB的数据是基于索引组织的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录加的 锁。对于行级锁，主要分为以下三类：</p>
<ol>
<li>行锁（Record Lock）：锁定单个行记录的锁，防止其他事务对此行进行update和delete。在<strong>RC、RR隔离级别</strong>下都支持。</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805160539111.86tyotgiyz.webp"
                         alt="image-20250805160539111" 
                 >

<ol start="2">
<li>间隙锁（Gap Lock）：锁定索引记录间隙（不含该记录），确保索引记录间隙不变，防止其他事务在<strong>这个间隙进行insert</strong>，产生<strong>幻读</strong>。在<strong>RR隔离级别</strong>下都支持。</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805160548665.5c1aj11c7f.webp"
                         alt="image-20250805160548665" 
                 >

<ol start="3">
<li>临键锁（Next-Key Lock）：行锁和间隙锁组合，同时锁住数据，并锁住数据前面的间隙Gap。 在<strong>RR隔离级别</strong>下支持。</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805160600235.13m397b3f0.webp"
                         alt="image-20250805160600235" 
                 >

<h2 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h2><p>InnoDB实现了以下两种类型的行锁： </p>
<ol>
<li>共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排它锁。</li>
<li>排他锁（X）：允许获取排他锁的事务更新数据，阻止<strong>其他事务获得相同数据集</strong>的共享锁和排他锁。</li>
</ol>
<p>他们之间的冲突兼容性如下：</p>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805160737609.5xay5bvsi5.webp"
                         alt="image-20250805160737609" 
                 >

<p>常见的SQL语句，在执行时，所加的行锁如下：</p>
<table>
<thead>
<tr>
<th>SQL</th>
<th>行锁类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>排他锁</td>
<td>自动加锁</td>
</tr>
<tr>
<td>UPDATE</td>
<td>排他锁</td>
<td>自动加锁</td>
</tr>
<tr>
<td>DELETE</td>
<td>排他锁</td>
<td>自动加锁</td>
</tr>
<tr>
<td>SELECT（正常）</td>
<td>不加任何锁</td>
<td></td>
</tr>
<tr>
<td>SELECT … LOCK IN SHARE MODE</td>
<td>共享锁</td>
<td>需要手动在SELECT之后加LOCK IN SHARE MODE</td>
</tr>
<tr>
<td>SELECT … FOR UPDATE</td>
<td>排他锁</td>
<td>需要手动在SELECT之后加FOR UPDATE</td>
</tr>
</tbody></table>
<p>接下来我们来探究，各种操作的加锁情况及兼容性：</p>
<p><strong>数据准备：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `stu`  (</span><br><span class="line">`id` <span class="type">int</span> <span class="keyword">NOT NULL</span>  <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`age` <span class="type">int</span> <span class="keyword">NOT NULL</span></span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="keyword">CHARACTER SET</span> <span class="operator">=</span> utf8mb4;</span><br><span class="line"><span class="keyword">INSERT INTO</span> `stu` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;tom&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `stu` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `stu` <span class="keyword">VALUES</span> (<span class="number">8</span>, <span class="string">&#x27;rose&#x27;</span>, <span class="number">8</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `stu` <span class="keyword">VALUES</span> (<span class="number">11</span>, <span class="string">&#x27;jetty&#x27;</span>, <span class="number">11</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `stu` <span class="keyword">VALUES</span> (<span class="number">19</span>, <span class="string">&#x27;lily&#x27;</span>, <span class="number">19</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `stu` <span class="keyword">VALUES</span> (<span class="number">25</span>, <span class="string">&#x27;luci&#x27;</span>, <span class="number">25</span>);</span><br></pre></td></tr></table></figure>

<ol>
<li>普通的select语句，执行时，不会加锁。</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805161835404.60uk31ov7y.webp"
                         alt="image-20250805161835404" 
                 >

<ol start="2">
<li>select…lock in share mode，加共享锁，</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805162453923.54y2nlf6rz.webp"
                         alt="image-20250805162453923" 
                 >

<blockquote>
<p>共享锁与共享锁之间兼容。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805162532944.5fkwgquexb.webp"
                         alt="image-20250805162532944" 
                 >

<blockquote>
<p>共享锁与排他锁之间互斥:客户端二想获取id为1这行的排他锁，会处于阻塞状态，以为共享锁与排他锁之间互斥。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805162757996.sz9g1vv9s.webp"
                         alt="image-20250805162757996" 
                 >

<ol start="3">
<li>排它锁与排他锁之间互斥</li>
</ol>
<blockquote>
<p>当客户端一，执行update语句，会为id为1的记录添加排他锁； 客户端二，如果也执行update语句更 新id为1的数据，也要为id为1的数据加排他锁，但是客户端二会处于阻塞状态，因为排他锁之间是互斥的。 直到客户端一，把事务提交了，才会把这一行的行锁释放，此时客户端二，解除阻塞。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805162948942.7pltr1ez4.webp"
                         alt="image-20250805162948942" 
                 >

<ol start="4">
<li>无索引行锁升级为表锁</li>
</ol>
<blockquote>
<p>在客户端一中，开启事务，并执行update语句，更新name为1的数据，也就是id为1的记录；然后在客户端二中更新id为1的记录**（这里应该更新id不同的行，才能体现升级为表锁，做测试的时候忽略了，在此抱歉）<strong>客户端一，根据name字段进行更新时，name字段是</strong>没有索引的**，如果没有索引， 此时行锁会升级为表锁(因为行锁是对索引项加的锁，而name没有索引)。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805163331182.2a5eht000h.webp"
                         alt="image-20250805163331182" 
                 >

<h2 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h2><blockquote>
<p>默认情况下，InnoDB在 REPEATABLE READ事务隔离级别运行，InnoDB使用 next-key 锁进行搜索和索引扫描，以防止幻读。 </p>
</blockquote>
<p>具有以下优化特点：</p>
<ol>
<li>索引上的<strong>等值查询(唯一索引)</strong>，给不存在的记录加锁时, 优化为间隙锁 。 </li>
<li>索引上的<strong>等值查询(非唯一普通索引)</strong>，向右遍历时最后一个值不满足查询需求时，next-key  lock <strong>退化为间隙锁</strong>。 </li>
<li>索引上的<strong>范围查询(唯一索引)</strong>，会访问到不满足条件的第一个值为止。</li>
</ol>
<blockquote>
<p>注意：间隙锁唯一目的是防止其他事务插入间隙。</p>
<p>间隙锁可以共存，<strong>一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁。</strong></p>
</blockquote>
<p>针对于这三个特点，我们依次测试：</p>
<ol>
<li>索引上的等值查询(唯一索引)，给不存在的记录加锁时, 优化为间隙锁 。</li>
</ol>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805164618985.pfnic2sk2.webp"
                         alt="image-20250805164618985" 
                 >

<blockquote>
<p>这时3-8的间隙无法插入数据。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805164758794.3uv5h9x7gz.webp"
                         alt="image-20250805164758794" 
                 >

<ol start="2">
<li>索引上的等值查询(非唯一普通索引)，向右遍历时最后一个值不满足查询需求时，next-key  lock 退化为间隙锁。</li>
</ol>
<blockquote>
<p>我们知道InnoDB的B+树索引，叶子节点是有序的双向链表。 </p>
<p>假如，我们要根据这个二级索引查询值为18的数据，并加上<strong>共享锁</strong>，我们是只锁定18这一行就可以了吗？ </p>
<p>并不是，因为<strong>是非唯一索引</strong>，这个 结构中可能有<strong>多个18</strong>的存在，所以，在加锁时会<strong>继续往后找</strong>，找到一个不满足条件的值（当前案例中也就是29）。此时会对18加临键锁，并对29之前的间隙加锁。</p>
</blockquote>
<p>我们来测试一下，先给<code>age</code>创建一个非唯一索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_stu_age <span class="keyword">on</span> stu(age);</span><br></pre></td></tr></table></figure>

<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805165736128.4g4t3krnro.webp"
                         alt="image-20250805165736128" 
                 >

<ol start="3">
<li>索引上的范围查询(唯一索引)–会访问到不满足条件的第一个值为止。</li>
</ol>
<blockquote>
<p>查询的条件为id&gt;&#x3D;19，并添加共享锁。 此时我们可以根据数据库表中现有的数据，将数据分为三个部 分：  [19] (19,25] (25,+∞] 所以数据库数据在加锁是，就是将19加了行锁，25的临键锁（包含25及25之前的间隙），正无穷的临键锁(正无穷及之前的间隙)。</p>
</blockquote>
<img    
                       lazyload
                       alt="image"
                       data-src="https://OperationT00.github.io/picx-images-hosting/blog-assets-MySQL锁/image-20250805170346286.99tnzpccut.webp"
                         alt="image-20250805170346286" 
                 >
















































                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/MySQL/">MySQL</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2025/08/04/MySQL-%E8%A7%86%E5%9B%BE%E3%80%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%8F%8A%E8%A7%A6%E5%8F%91%E5%99%A8/"
                                   title="MySQL--视图、存储过程及触发器"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">MySQL--视图、存储过程及触发器</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="nav-text">全局锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="nav-text">表级锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E9%94%81"><span class="nav-text">表锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E9%94%81"><span class="nav-text">读锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E9%94%81"><span class="nav-text">写锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%94%81"><span class="nav-text">元数据锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="nav-text">意向锁</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="nav-text">行级锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E9%94%81"><span class="nav-text">行锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%B4%E9%9A%99%E9%94%81"><span class="nav-text">间隙锁</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">T00</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    
        <div class="count-info info-item">
            
                <span class="count-item border-box word">
                    <span class="item-type border-box">Total words</span>
                    <span class="item-value border-box word">44.1k</span>
                </span>
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">Unique Visitor</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-item border-box pv">
                    <span class="item-type border-box">Page View</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="nav-text">全局锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="nav-text">表级锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E9%94%81"><span class="nav-text">表锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E9%94%81"><span class="nav-text">读锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E9%94%81"><span class="nav-text">写锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%94%81"><span class="nav-text">元数据锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="nav-text">意向锁</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="nav-text">行级锁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E9%94%81"><span class="nav-text">行锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%B4%E9%9A%99%E9%94%81"><span class="nav-text">间隙锁</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/header-shrink.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/back2top.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/toggle-theme.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/code-block.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/local-search.min.js"></script>


<!-- lazyload -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/lazyload.min.js"></script>


<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/post/post-helper.min.js"></script>

        <!-- toc -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/post/toc.min.js"></script>
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>




</body>
</html>
